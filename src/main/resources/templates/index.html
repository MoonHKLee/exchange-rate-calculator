<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .select-container {
            display: flex;
            align-items: center;
        }
        .select-container label {
            margin-right: 10px;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
<H1>환율계산</H1>

<h3>송금국가:미국(USD)</h3>
<h3>
    <form>
        <div class="select-container">
            <label for="currency">수취국가:</label>
            <select id="currency">
                <option value="USDKRW">한국(KRW)</option>
                <option value="USDJPY">일본(JPY)</option>
                <option value="USDPHP">필리핀(PHP)</option>
            </select>
        </div>
    </form>
</h3>
<h3>환율: <span id="rate" th:text="${rate}"></span></h3>
<h3>송금액:<label for="amount"></label><input type="text" id="amount">USD</h3>
<button id="btn">계산</button>

<h3 id="totalAmount"></h3>
</body>
</html>

<script>
    // 수취 국가 변경 이벤트 리스너
    const selectElement = document.getElementById("currency");
    selectElement.addEventListener("change", function() {
        const selectedCurrency = selectElement.value;
        fetch(`/exchangeRate?exchangeRateKey=${selectedCurrency}`)
            .then(response => response.text())
            .then(data => {
                const rateElement = document.getElementById("rate");
                rateElement.textContent = data + " " + selectedCurrency.substring(3)+"/USD";
            })
            .catch(error => {
                console.error("Error fetching exchange rate:", error);
            });
    });

    // 계산 버튼 클릭 이벤트 리스너
    const calculateButton = document.getElementById("btn");
    calculateButton.addEventListener("click", function () {
        const amountInput = document.getElementById("amount");
        const rateElement = document.getElementById("rate");
        const totalAmountElement = document.getElementById("totalAmount");

        const amount = parseFloat(amountInput.value);
        const rate = parseFloat(rateElement.textContent.replace(/,/g, "").split(" ")[0]);

        if (isNaN(amount) || amount <= 0 || amount >= 10000 || !Number.isInteger(amount)) {
            totalAmountElement.textContent = "송금액이 바르지 않습니다.";
            totalAmountElement.classList.add("error");
        } else {
            const totalAmount = amount * rate;
            totalAmountElement.textContent = "수취 금액은 " + totalAmount.toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + " " + selectElement.value.substring(3) + " 입니다.";
            totalAmountElement.classList.remove("error");
        }
    });



</script>